<h1>What
  <% if @is_an_owner %>
    You Listen to
  <% else %>
    <%= user.username %> Listens to
  <% end %>
</h1>
<table id="song_table">
  <tr>
    <th>Title</th>
    <th>Artist</th>
    <th>YouTube URL</th>
    <% if @is_an_owner %>
      <th></th>
      <th></th>
    <% end %>
  </tr>
  <% @songs.each do |song| %>
    <tr>
      <td><%= song.title %></td>
      <td><%= song.artist %></td>
      <td>
        <button class="btn-primary" data-toggle="modal" data-target="#myModal<%= song.id %>">
          Listen here
        </button>

        <div class="modal fade" id="myModal<%= song.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              </div>
              <div class="modal-body">
                <iframe width="560" height="315" src="//www.youtube.com/embed/<%= song.youtube_id %>" frameborder="0" allowfullscreen></iframe>
              </div>
            </div>
          </div>
        </div>

      </td>
      <% if @is_an_owner %>
        <td><%= link_to "Edit Song", [:edit, user, song] %></td>
        <td><%= button_to "Delete Song", [user, song], method: :delete, data: {confirm: "Are you sure?"} %></td>
      <% end %>
    </tr>
  <% end %>
</table>

<br>
<% if @is_an_owner %>
  <%= link_to 'Add a New Song', new_user_song_path(user) %>
<% end %>

<hr><br>

<script type="text/javascript" charset="utf-8">

  $(function () {
    $('#view-count-chart').highcharts({
      chart: {
        type: 'bar'
      },
      title: {
        text: 'Youtube Videos by Viewer Statistics'
      },
      subtitle: {
        text: 'Source: Youtube.com'
      },
      xAxis: {
        categories: <%= raw @song_titles %>,
        title: {
          text: 'Song Title'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Viewer Statistics (viewers)',
          align: 'high'
        },
        labels: {
          overflow: 'justify'
        }
      },
      tooltip: {
        valueSuffix: ' viewers'
      },
      plotOptions: {
        bar: {
          dataLabels: {
            enabled: true
          }
        }
      },
      credits: {
        enabled: false
      },
      series: [
        {
          name: 'likes',
          data: <%= @song_likes %>
        },
        {
          name: 'total views',
          data: <%= @song_views %>
        }
      ]
    });
  });
</script>

<div id="view-count-chart"></div>
